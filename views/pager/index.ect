<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <style>
        body {
            font-family: 'Helvetica Neue', sans-serif;
            font-size: 14pt;
            font-weight: 300;

            margin: 0;
            text-align: center;
        }

        .page {
            overflow: hidden;
        }

        .page__layer {
            position: absolute;
        }

        .page__layer_hidden {
            display: none;
        }

        .page__layer_transition {
            cursor: pointer;
        }

        .page__layer-children {
            position: relative;
        }
    </style>
</head>

<body>
    <script>
        var snapshot = <%- JSON.stringify(@document) %>;

        var isFirstArtboardProcessed = false;

        var getArtboardNavigationClass = function(index) {
            return 'page__layer_artboard-' + index;
        };

        var renderLayer = function(layer, i) {
            var element = d3.select(this)
                .classed('page__layer_artboard', layer.type === 'artboard')
                .classed(getArtboardNavigationClass(i), layer.type === 'artboard')
                .classed('page__layer_hidden', layer.type === 'artboard' && isFirstArtboardProcessed)
                .style('width', layer.frame.width + 'px')
                .style('height', layer.frame.height + 'px')
                .attr('data-name', layer.name);

            if (layer.type === 'artboard') {
                isFirstArtboardProcessed = true;

                element.style('background-image', 'url("' + layer.image + '")');
            }

            if (layer.type !== 'artboard') {
                element.style('top', layer.frame.y + 'px')
                    .style('left', layer.frame.x + 'px');
            }

            if (layer.children !== undefined) {
                element.append('div')
                    .classed('page__layer__children', true)
                    .selectAll('.page__layer')
                    .data(layer.children)
                    .enter()
                    .append('div')
                    .classed('page__layer', true)
                    .each(renderLayer);
            }

            if (layer.transition !== undefined) {
                element.classed('page__layer_transition', true)
                    .on('click', function() {
                        var artboard = d3.select(this);

                        while (!artboard.classed('page__layer_artboard')) {
                            artboard = d3.select(artboard.node().parentNode);
                        }

                        artboard.classed('page__layer_hidden', true);

                        d3.select('.' + getArtboardNavigationClass(layer.transition))
                            .classed('page__layer_hidden', false);
                    });
            }
        };

        var renderPage = function(page) {
            d3.select(this)
                .selectAll('.page__layer')
                .data(page.layers)
                .enter()
                .append('div')
                .classed('page__layer', true)
                .each(renderLayer);
        };

        var renderSnapshot = function(snapshot) {
            d3.select('body')
                .selectAll('.page')
                .data(snapshot.pages)
                .enter()
                .append('div')
                .classed('page', true)
                .each(renderPage);
        };

        renderSnapshot(snapshot);
    </script>

    <!-- Yandex.Metrika counter --> <script type="text/javascript"> (function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter43828674 = new Ya.Metrika({ id:43828674, clickmap:true, trackLinks:true, accurateTrackBounce:true, webvisor:true, trackHash:true, ut:"noindex" }); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = "https://mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks"); </script> <noscript><div><img src="https://mc.yandex.ru/watch/43828674?ut=noindex" style="position:absolute; left:-9999px;" alt="" /></div></noscript> <!-- /Yandex.Metrika counter -->
</body>

</html>